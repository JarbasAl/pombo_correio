from pombo_correio import TorBrowser
from time import sleep


if __name__ == "__main__":
    from os.path import join, dirname, expanduser

    gecko_driver = join(dirname(__file__), "geckodriver")
    # https://github.com/mozilla/geckodriver/releases

    binary = expanduser("~/Downloads/tor-browser_en-US/Browser/firefox")
    # Using context manager
    with TorBrowser(gecko_driver,
                    headless=True,
                    js_enabled=False,
                    binary=binary) as browser:
        browser.got_to_url("https://browserleaks.com/ip")
        # TODO wait for element that indicates page loaded
        browser.scroll_down(5)
        sleep(1)
        browser.save_screenshot("tor_browserleaks.png")

        browser.got_to_url("https://check.torproject.org/")
        browser.find_and_click_xpath("/html/body/div[2]/p[2]/a[2]")
        browser.wait_for_xpath("/html/body/div/div[4]/div[2]/h2/span")
        browser.scroll_down(5)
        sleep(1)
        browser.save_screenshot("tor_relay.png")
"""
BrowserEvents.BROWSER_OPEN {'open_tabs': ['15'], 'tab_id': '15', 'homepage': 'https://torproject.org/'}
BrowserEvents.OPEN_URL {'url': 'https://browserleaks.com/ip', 'old_url': 'https://www.torproject.org/', 'tab_id': '15'}
BrowserEvents.ELEMENT_SEND_KEYS {'keys': ['\ue015', '\ue015', '\ue015', '\ue015', '\ue015'], 'element_text': 'Home Page\nIP Address\nJavaScript\nWebRTC Leak Test\nCanvas Fingerprint\nWebGL Report\nFont Fingerprinting\nSSL Client Test\nGeolocation API\nFeatures Detection\nContent Filters\nJava Applet\nFlash Player\nSilverlight\nMore Tools\nSettings\nWhat Is My IP Address\nMy IP Address\nIP address 77.247.181.162\nHostname chomsky.torservers.net\nIP Address Location\nCountry Netherlands (NL)\nState/Region South Holland (ZH)\nCity Dordrecht\nISP NForce Entertainment B.V.\nASN 43350\nTimezone Europe/Amsterdam\nLocal Time Tue, 13 Oct 2020 22:14:32 +0200\nLatitude/Longitude 51.7731,4.6752\nIPv6 Leak Test\nIPv6 Address\n2a0b:f4c0:16c:16::1\nWebRTC Leak Test\nLocal IP address n/a\nPublic IP address n/a\nDNS Leak Test\nTest Results Found 2 Servers, 1 ISP, 1 Location\nYour DNS Servers\nIP Address : ISP : Location :\n185.220.100.130 F3 Netze e.V. Germany\n2a0b:f4c0:16c:130::1 F3 Netze e.V. Germany\nFlash Leak Test\nFlash IP address n/a\nTCP/IP Fingerprint\nOS Linux (2.2.x-3.x)\nLink Ethernet or modem\nMTU 1500\nDistance 11 Hops\nHTTP Headers\nraw headers\nRequest GET /ip HTTP/2.0\nHost browserleaks.com\nUser-Agent Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:81.0) Gecko/20100101 Firefox/81.0\nAccept text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\nAccept-Language en-US,en;q=0.5\nAccept-Encoding gzip, deflate, br\nUpgrade-Insecure-Requests 1\nTE trailers\n\n\n\n\n\n\n\n\nTor Relay Details\nRelays\n✔\nFound 3 Tor Relays matching your IP [show all / hide all]\nRelay #1 Fingerprint 204DFD2A2C6A0DC1FA0EACB495218E0B661704FD\nRunning\n✔\nTrue\nNickname HaveHeart\nCountry Netherlands\nLatitude/Longitude 52.3824,4.8995\nAS Number AS43350\nAS Name NForce Entertainment B.V.\nOR Addresses 77.247.181.164:443\nExit Addresses 77.247.181.162\nDir Address 77.247.181.164:80\nVerified Host Names rainbowwarrior.torservers.net\nFlags\nExit Policy\nreject 0.0.0.0/8:*\nreject 169.254.0.0/16:*\nreject 127.0.0.0/8:*\nreject 192.168.0.0/16:*\nreject 10.0.0.0/8:*\nreject 172.16.0.0/12:*\nreject 77.247.181.164:*\nreject *:25\nreject 45.79.79.0/24:*\nreject 45.79.65.0/24:*\naccept *:*\nFirst Seen 2017-10-03 00:00:00 UTC\nLast Seen 2020-10-13 19:00:00 UTC\nLast Restarted 2020-09-23 04:49:47 UTC\nBandwidth 51.68 MB/s\nContact https://www.torservers.net/donate.html <support .AT. torservers .DOT. net>\nPlatform Tor 0.4.4.5 on Linux\nVersion Status Recommended\nRelay #2 Fingerprint 77131D7E2EC1CA9B8D737502256DA9103599CE51\n\n\n\n\n\n\n\n\n\n\nRelay #3 Fingerprint 7BFB908A3AA5B491DA4CA72CCBEE0E1F2A939B55\n\n\n\n\n\n\n\n\n\n\nWhere is My IP\n77.247.181.162\n+\n−\n© OpenStreetMap contributors, © CARTO\nIP Address Whois\nWhois 77.247.181.162\ninetnum:        77.247.181.160 - 77.247.181.175\nnetname:        ZWIEBELFREUNDE\ndescr:          Customer 692 / Zwiebelfreunde e.V.\nremarks:        Sent abuse to: abuse@torservers.net\ncountry:        NL\nadmin-c:        MB22990-RIPE\ntech-c:         MB22990-RIPE\nabuse-c:        AR18597-RIPE\nstatus:         ASSIGNED PA\nmnt-by:         MNT-NFORCE\nmnt-lower:      MNT-NFORCE\nmnt-routes:     MNT-NFORCE\ncreated:        2015-02-04T09:09:24Z\nlast-modified:  2019-09-17T10:54:47Z\nsource:         RIPE # Filtered\n\nperson:         Moritz Bartl\naddress:        Zwiebelfreunde e.V.\naddress:        c/o DID Dresdner Institut fuer Datenschutz\naddress:        Palaisplatz 3\naddress:        01097 Dresden\naddress:        Germany\nphone:          +49-351-21296018\nfax-no:         +49-8131-9044975\nremarks:        ---------------------------------\nremarks:        This network is used for research\nremarks:        in anonymization services and\nremarks:        provides Tor exit nodes to end\nremarks:        users.\nremarks:        ---------------------------------\nremarks:        Dieser Netzblock wird zur\nremarks:        Erforschung von Anonymisierungs-\nremarks:        techniken genutzt und stellt\nremarks:        Endnutzern Tor zur Verfuegung.\nremarks:        ---------------------------------\nremarks:        http://www.torservers.net/abuse.html\nremarks:        ---------------------------------\nnic-hdl:        MB22990-RIPE\nmnt-by:         ZWIEBELFREUNDE\ncreated:        2011-02-11T04:11:32Z\nlast-modified:  2019-10-03T21:50:51Z\nsource:         RIPE # Filtered\n\nroute:          77.247.176.0/21\ndescr:          NFOrce Entertainment BV - route 77.247.176.0/21\norigin:         AS43350\nmnt-by:         MNT-NFORCE\ncreated:        2020-05-01T07:14:42Z\nlast-modified:  2020-05-01T07:14:42Z\nsource:         RIPE\nFurther Reading\n\nLeave a Comment (113)\nBrowserLeaks © 2011-2020 All Right Reserved\nmoc.skaelresworb@nimda', 'tab_id': '15', 'url': 'https://browserleaks.com/ip', 'href': None}
BrowserEvents.SCREENSHOT {'image': 'tor_browserleaks.png', 'tab_id': '15', 'url': 'https://browserleaks.com/ip'}
BrowserEvents.OPEN_URL {'url': 'https://check.torproject.org/', 'old_url': 'https://browserleaks.com/ip', 'tab_id': '15'}
BrowserEvents.WAIT_FOR_XPATH {'xpath': '/html/body/div[2]/p[2]/a[2]', 'timeout': 10, 'tab_id': '15', 'url': 'https://check.torproject.org/'}
BrowserEvents.XPATH_FOUND {'xpath': '/html/body/div[2]/p[2]/a[2]', 'timeout': 10, 'tab_id': '15', 'url': 'https://check.torproject.org/', 'element_text': 'Relay Search', 'href': 'https://metrics.torproject.org/rs.html#search/185.220.100.243', 'element_id': 'b0246841-66b4-40f3-b14d-7e32336e9a3a'}
BrowserEvents.ELEMENT_CLICKED {'xpath': '/html/body/div[2]/p[2]/a[2]', 'element_text': 'Relay Search', 'tab_id': '15', 'url': 'https://check.torproject.org/', 'href': 'https://metrics.torproject.org/rs.html#search/185.220.100.243'}
BrowserEvents.WAIT_FOR_XPATH {'xpath': '/html/body/div/div[4]/div[2]/h2/span', 'timeout': 30, 'tab_id': '15', 'url': 'https://metrics.torproject.org/rs.html#search/185.220.100.243'}
BrowserEvents.XPATH_NOT_FOUND {'xpath': '/html/body/div/div[4]/div[2]/h2/span', 'timeout': 30, 'tab_id': '15', 'url': 'https://metrics.torproject.org/rs.html#search/185.220.100.243'}
BrowserEvents.ELEMENT_SEND_KEYS {'keys': ['\ue015', '\ue015', '\ue015', '\ue015', '\ue015'], 'element_text': 'News\nSources\nServices\nDevelopment\nResearch\nAbout\nHome\nUsers\nServers\nTraffic\nPerformance\nOnion Services\nApplications\nThe Tor Project is working with Simply Secure to improve the experience of the Tor Metrics website. Want to collaborate? Take this survey!\nHomeServicesRelay SearchSearch for 185.220.100.243\nRelay Search\n185.220.100.243\nShow\n10\n25\n50\n100\nentries\nNickname† Advertised Bandwidth Uptime Country IPv4 IPv6 Flags Add. Flags ORPort DirPort Type\n  Total 96.33 MiB/s                  \nF3Netze (32) 52.27 MiB/s 25d 15h 185.220.100.243 2a0b:f4c0:16c:16::1 9000 9001 Relay\nF3Netze (32) 44.06 MiB/s 25d 15h 185.220.100.243 2a0b:f4c0:16c:16::1 9100 9101 Relay\nShowing 1 to 2 of 2 entries\nPrevious\n1\nNext\n†The number shown in parentheses is the total effective family size for the relay including the relay itself. A size of 1 indicates that the relay does not have any other effective family members. Note that bridge relays do not advertise family members in their descriptors and so there is no value shown for bridge relays.\nInformation for relays was published: 2020-10-13 19:00:00 UTC.\nInformation for bridges was published: 2020-10-13 18:57:56 UTC.\nOnionoo version: 8.0/27f3bbb\n© 2009–2018 The Tor Project\nContact\nThis material is supported in part by the National Science Foundation under Grant No. CNS-0959138. Any opinions, finding, and conclusions or recommendations expressed in this material are those of the author(s) and do not necessarily reflect the views of the National Science Foundation. "Tor" and the "Onion Logo" are registered trademarks of The Tor Project, Inc.. Data on this site is freely available under a CC0 no copyright declaration: To the extent possible under law, the Tor Project has waived all copyright and related or neighboring rights in the data. Graphs are licensed under a Creative Commons Attribution 3.0 United States License.', 'tab_id': '15', 'url': 'https://metrics.torproject.org/rs.html#search/185.220.100.243', 'href': None}
BrowserEvents.SCREENSHOT {'image': 'tor_relay.png', 'tab_id': '15', 'url': 'https://metrics.torproject.org/rs.html#search/185.220.100.243'}
BrowserEvents.BROWSER_CLOSED {'open_tabs': ['15'], 'tab_id': '15', 'current_url': 'https://metrics.torproject.org/rs.html#search/185.220.100.243', 'tab2url': {'15': 'https://check.torproject.org/'}}
"""